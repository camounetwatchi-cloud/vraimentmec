files:
  "/tmp/install_stockfish.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      
      STOCKFISH_DIR="/var/app/current/engine"
      STOCKFISH_BIN="$STOCKFISH_DIR/stockfish"
      
      echo "Checking for Stockfish..."
      
      # Créer le dossier engine s'il n'existe pas
      mkdir -p "$STOCKFISH_DIR"
      
      # Télécharger Stockfish si pas présent ou invalide
      if [ ! -f "$STOCKFISH_BIN" ] || [ ! -x "$STOCKFISH_BIN" ]; then
        echo "Downloading Stockfish for Linux..."
        cd "$STOCKFISH_DIR"
        
        # Télécharger
        wget -q https://github.com/official-stockfish/Stockfish/releases/download/sf_16.1/stockfish-ubuntu-x86-64-avx2.tar
        
        if [ $? -eq 0 ]; then
          # Extraire
          tar -xf stockfish-ubuntu-x86-64-avx2.tar
          
          # Renommer et déplacer
          mv stockfish/stockfish-ubuntu-x86-64-avx2 stockfish
          
          # Donner les permissions d'exécution
          chmod +x stockfish
          
          # Nettoyer
          rm -rf stockfish-ubuntu-x86-64-avx2.tar stockfish/
          
          echo "Stockfish installed successfully at $STOCKFISH_BIN"
        else
          echo "ERROR: Failed to download Stockfish"
          exit 1
        fi
      else
        echo "Stockfish already exists and is executable"
      fi
      
      # Vérifier que Stockfish fonctionne
      if "$STOCKFISH_BIN" --version > /dev/null 2>&1; then
        echo "Stockfish is working correctly"
      else
        echo "WARNING: Stockfish binary exists but may not work properly"
      fi

commands:
  01_install_stockfish:
    command: /tmp/install_stockfish.sh
    ignoreErrors: false
```

### 7. **Créer `Procfile` à la racine**
```
web: gunicorn --bind 0.0.0.0:8000 --workers 2 --threads 2 --timeout 120 backend.app:app
